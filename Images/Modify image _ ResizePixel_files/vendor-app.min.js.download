var EditVendorAppFallback={},Utils,Utils,Utils,Utils,Utils,Utils,Utils,Utils,Utils,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,EditOperations,Edit,Edit,Utils,Shared,Shared;
/*!
  * Bootstrap v5.0.0 (https://getbootstrap.com/)
  * Copyright 2011-2021 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).bootstrap=t()}(this,(function(){"use strict";const e="transitionend",t=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let i=e.getAttribute("href");if(!i||!i.includes("#")&&!i.startsWith("."))return null;i.includes("#")&&!i.startsWith("#")&&(i=`#${i.split("#")[1]}`),t=i&&"#"!==i?i.trim():null}return t},i=e=>{const i=t(e);return i&&document.querySelector(i)?i:null},r=e=>{const i=t(e);return i?document.querySelector(i):null},n=e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:i}=window.getComputedStyle(e);const r=Number.parseFloat(t),n=Number.parseFloat(i);return r||n?(t=t.split(",")[0],i=i.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(i))):0},s=e=>(e[0]||e).nodeType,o=(t,i)=>{let r=!1;const n=i+5;t.addEventListener(e,(function i(){r=!0,t.removeEventListener(e,i)})),setTimeout((()=>{r||(t=>{t.dispatchEvent(new Event(e))})(t)}),n)},a=()=>{const{jQuery:e}=window;return e&&!document.body.hasAttribute("data-bs-no-jquery")?e:null},l=new Map;var c={set(e,t,i){l.has(e)||l.set(e,new Map);const r=l.get(e);r.has(t)||0===r.size?r.set(t,i):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`)},get:(e,t)=>l.has(e)&&l.get(e).get(t)||null,remove(e,t){if(!l.has(e))return;const i=l.get(e);i.delete(t),0===i.size&&l.delete(e)}};const d=/[^.]*(?=\..*)\.|.*/,u=/\..*/,h=/::\d+$/,p={};let g=1;const m={mouseenter:"mouseover",mouseleave:"mouseout"},S=/^(mouseenter|mouseleave)/i,E=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function C(e,t){return t&&`${t}::${g++}`||e.uidEvent||g++}function v(e){const t=C(e);return e.uidEvent=t,p[t]=p[t]||{},p[t]}function f(e,t,i=null){const r=Object.keys(e);for(let n=0,s=r.length;n<s;n++){const s=e[r[n]];if(s.originalHandler===t&&s.delegationSelector===i)return s}return null}function I(e,t,i){const r="string"==typeof t,n=r?i:t;let s=b(e);return E.has(s)||(s=e),[r,n,s]}function y(e,t,i,r,n){if("string"!=typeof t||!e)return;if(i||(i=r,r=null),S.test(t)){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)};r?r=e(r):i=e(i)}const[s,o,a]=I(t,i,r),l=v(e),c=l[a]||(l[a]={}),u=f(c,o,s?i:null);if(u)return void(u.oneOff=u.oneOff&&n);const h=C(o,t.replace(d,"")),p=s?function(e,t,i){return function r(n){const s=e.querySelectorAll(t);for(let{target:o}=n;o&&o!==this;o=o.parentNode)for(let a=s.length;a--;)if(s[a]===o)return n.delegateTarget=o,r.oneOff&&U.off(e,n.type,t,i),i.apply(o,[n]);return null}}(e,i,r):function(e,t){return function i(r){return r.delegateTarget=e,i.oneOff&&U.off(e,r.type,t),t.apply(e,[r])}}(e,i);p.delegationSelector=s?i:null,p.originalHandler=o,p.oneOff=n,p.uidEvent=h,c[h]=p,e.addEventListener(a,p,s)}function O(e,t,i,r,n){const s=f(t[i],r,n);s&&(e.removeEventListener(i,s,Boolean(n)),delete t[i][s.uidEvent])}function b(e){return e=e.replace(u,""),m[e]||e}const U={on(e,t,i,r){y(e,t,i,r,!1)},one(e,t,i,r){y(e,t,i,r,!0)},off(e,t,i,r){if("string"!=typeof t||!e)return;const[n,s,o]=I(t,i,r),a=o!==t,l=v(e),c=t.startsWith(".");if(void 0!==s){if(!l||!l[o])return;return void O(e,l,o,s,n?i:null)}c&&Object.keys(l).forEach((i=>{!function(e,t,i,r){const n=t[i]||{};Object.keys(n).forEach((s=>{if(s.includes(r)){const r=n[s];O(e,t,i,r.originalHandler,r.delegationSelector)}}))}(e,l,i,t.slice(1))}));const d=l[o]||{};Object.keys(d).forEach((i=>{const r=i.replace(h,"");if(!a||t.includes(r)){const t=d[i];O(e,l,o,t.originalHandler,t.delegationSelector)}}))},trigger(e,t,i){if("string"!=typeof t||!e)return null;const r=a(),n=b(t),s=t!==n,o=E.has(n);let l,c=!0,d=!0,u=!1,h=null;return s&&r&&(l=r.Event(t,i),r(e).trigger(l),c=!l.isPropagationStopped(),d=!l.isImmediatePropagationStopped(),u=l.isDefaultPrevented()),o?(h=document.createEvent("HTMLEvents"),h.initEvent(n,c,!0)):h=new CustomEvent(t,{bubbles:c,cancelable:!0}),void 0!==i&&Object.keys(i).forEach((e=>{Object.defineProperty(h,e,{get:()=>i[e]})})),u&&h.preventDefault(),d&&e.dispatchEvent(h),h.defaultPrevented&&void 0!==l&&l.preventDefault(),h}};function x(e){return"true"===e||"false"!==e&&(e===Number(e).toString()?Number(e):""===e||"null"===e?null:e)}function w(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}const A={setDataAttribute(e,t,i){e.setAttribute(`data-bs-${w(t)}`,i)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${w(t)}`)},getDataAttributes(e){if(!e)return{};const t={};return Object.keys(e.dataset).filter((e=>e.startsWith("bs"))).forEach((i=>{let r=i.replace(/^bs/,"");r=r.charAt(0).toLowerCase()+r.slice(1,r.length),t[r]=x(e.dataset[i])})),t},getDataAttribute:(e,t)=>x(e.getAttribute(`data-bs-${w(t)}`)),offset(e){const t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},position:e=>({top:e.offsetTop,left:e.offsetLeft})},T={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter((e=>e.matches(t))),parents(e,t){const i=[];let r=e.parentNode;for(;r&&r.nodeType===Node.ELEMENT_NODE&&3!==r.nodeType;)r.matches(t)&&i.push(r),r=r.parentNode;return i},prev(e,t){let i=e.previousElementSibling;for(;i;){if(i.matches(t))return[i];i=i.previousElementSibling}return[]},next(e,t){let i=e.nextElementSibling;for(;i;){if(i.matches(t))return[i];i=i.nextElementSibling}return[]}},L="collapse",R="bs.collapse",H={toggle:!0,parent:""},P={toggle:"boolean",parent:"(string|element)"},q="show",z="collapse",D="collapsing",_="collapsed",B="width",k='[data-bs-toggle="collapse"]';class M extends class{constructor(e){(e="string"==typeof e?document.querySelector(e):e)&&(this._element=e,c.set(this._element,this.constructor.DATA_KEY,this))}dispose(){c.remove(this._element,this.constructor.DATA_KEY),U.off(this._element,`.${this.constructor.DATA_KEY}`),this._element=null}static getInstance(e){return c.get(e,this.DATA_KEY)}static get VERSION(){return"5.0.0"}}{constructor(e,t){super(e),this._isTransitioning=!1,this._config=this._getConfig(t),this._triggerArray=T.find(`${k}[href="#${this._element.id}"],${k}[data-bs-target="#${this._element.id}"]`);const r=T.find(k);for(let e=0,t=r.length;e<t;e++){const t=r[e],n=i(t),s=T.find(n).filter((e=>e===this._element));null!==n&&s.length&&(this._selector=n,this._triggerArray.push(t))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}static get Default(){return H}static get DATA_KEY(){return R}toggle(){this._element.classList.contains(q)?this.hide():this.show()}show(){if(this._isTransitioning||this._element.classList.contains(q))return;let e,t;this._parent&&(e=T.find(".show, .collapsing",this._parent).filter((e=>"string"==typeof this._config.parent?e.getAttribute("data-bs-parent")===this._config.parent:e.classList.contains(z))),0===e.length&&(e=null));const i=T.findOne(this._selector);if(e){const r=e.find((e=>i!==e));if(t=r?c.get(r,R):null,t&&t._isTransitioning)return}if(U.trigger(this._element,"show.bs.collapse").defaultPrevented)return;e&&e.forEach((e=>{i!==e&&M.collapseInterface(e,"hide"),t||c.set(e,R,null)}));const r=this._getDimension();this._element.classList.remove(z),this._element.classList.add(D),this._element.style[r]=0,this._triggerArray.length&&this._triggerArray.forEach((e=>{e.classList.remove(_),e.setAttribute("aria-expanded",!0)})),this.setTransitioning(!0);const s=`scroll${r[0].toUpperCase()+r.slice(1)}`,a=n(this._element);U.one(this._element,"transitionend",(()=>{this._element.classList.remove(D),this._element.classList.add(z,q),this._element.style[r]="",this.setTransitioning(!1),U.trigger(this._element,"shown.bs.collapse")})),o(this._element,a),this._element.style[r]=`${this._element[s]}px`}hide(){if(this._isTransitioning||!this._element.classList.contains(q))return;if(U.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,this._element.offsetHeight,this._element.classList.add(D),this._element.classList.remove(z,q);const t=this._triggerArray.length;if(t>0)for(let e=0;e<t;e++){const t=this._triggerArray[e],i=r(t);i&&!i.classList.contains(q)&&(t.classList.add(_),t.setAttribute("aria-expanded",!1))}this.setTransitioning(!0),this._element.style[e]="";const i=n(this._element);U.one(this._element,"transitionend",(()=>{this.setTransitioning(!1),this._element.classList.remove(D),this._element.classList.add(z),U.trigger(this._element,"hidden.bs.collapse")})),o(this._element,i)}setTransitioning(e){this._isTransitioning=e}dispose(){super.dispose(),this._config=null,this._parent=null,this._triggerArray=null,this._isTransitioning=null}_getConfig(e){return(e={...H,...e}).toggle=Boolean(e.toggle),((e,t,i)=>{Object.keys(i).forEach((r=>{const n=i[r],o=t[r],a=o&&s(o)?"element":null==(l=o)?`${l}`:{}.toString.call(l).match(/\s([a-z]+)/i)[1].toLowerCase();var l;if(!new RegExp(n).test(a))throw new TypeError(`${e.toUpperCase()}: Option "${r}" provided type "${a}" but expected type "${n}".`)}))})(L,e,P),e}_getDimension(){return this._element.classList.contains(B)?B:"height"}_getParent(){let{parent:e}=this._config;s(e)?void 0===e.jquery&&void 0===e[0]||(e=e[0]):e=T.findOne(e);const t=`${k}[data-bs-parent="${e}"]`;return T.find(t,e).forEach((e=>{const t=r(e);this._addAriaAndCollapsedClass(t,[e])})),e}_addAriaAndCollapsedClass(e,t){if(!e||!t.length)return;const i=e.classList.contains(q);t.forEach((e=>{i?e.classList.remove(_):e.classList.add(_),e.setAttribute("aria-expanded",i)}))}static collapseInterface(e,t){let i=c.get(e,R);const r={...H,...A.getDataAttributes(e),..."object"==typeof t&&t?t:{}};if(!i&&r.toggle&&"string"==typeof t&&/show|hide/.test(t)&&(r.toggle=!1),i||(i=new M(e,r)),"string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t]()}}static jQueryInterface(e){return this.each((function(){M.collapseInterface(this,e)}))}}var W,$,F;return U.on(document,"click.bs.collapse.data-api",k,(function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault();const t=A.getDataAttributes(this),r=i(this);T.find(r).forEach((e=>{const i=c.get(e,R);let r;i?(null===i._parent&&"string"==typeof t.parent&&(i._config.parent=t.parent,i._parent=i._getParent()),r="toggle"):r=t,M.collapseInterface(e,r)}))})),W=L,$=M,F=()=>{const e=a();if(e){const t=e.fn[W];e.fn[W]=$.jQueryInterface,e.fn[W].Constructor=$,e.fn[W].noConflict=()=>(e.fn[W]=t,$.jQueryInterface)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",F):F(),{Collapse:M}})),function(e){e.BrowserUtils=class{static onWindowLoad(e){"complete"===document.readyState?e():window.addEventListener("load",e)}static onDocumentReady(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}}}(Utils||(Utils={})),function(e){e.EventUtils=class{static triggerEvent(e,t){let i=document.createEvent("HTMLEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)}static triggerCustomEvent(e,t,i){var r;window.CustomEvent&&"function"==typeof window.CustomEvent?r=new CustomEvent(t,{detail:i}):(r=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,i),e.dispatchEvent(r)}static oneTimeEvent(e,t,i){let r=function(n){e.removeEventListener(t,r),i(n)};e.addEventListener(t,r)}}}(Utils||(Utils={})),function(e){e.ImageResize=class{constructor(t){this.triggerImageChangedEvent=()=>{e.EventUtils.triggerCustomEvent(this.image,"imageChanged")},this.image=document.querySelector(t),this.imageContainer=this.image.parentNode}resizeImageToFitContainer(){this.setImageVisible(!1),this.image.height=this.calcImageHeightToFitContainer(this.image.naturalWidth,this.image.naturalHeight),this.setImageVisible(!0)}setNewImageToFitContainer(t,i,r){let n=this.calcImageHeightToFitContainer(t,i);this.triggerImageChangingEvent(),this.setImageVisible(!1),e.EventUtils.oneTimeEvent(this.image,"load",this.triggerImageChangedEvent),this.image.height=n,this.image.src=r,this.setImageVisible(!0)}triggerImageChangingEvent(){e.EventUtils.triggerCustomEvent(this.image,"imageChanging")}calcImageHeightToFitContainer(e,t){let i,r,n=this.getPixelPropValue(this.imageContainer,"padding-left")+this.getPixelPropValue(this.imageContainer,"padding-right"),s=this.imageContainer.clientWidth-n-1,o=s/e,a=this.getPixelPropValue(this.imageContainer,"padding-bottom")+this.getPixelPropValue(this.imageContainer,"padding-top"),l=this.imageContainer.clientHeight-a-1,c=l/t;return(o<1||c<1)&&(i=o<c?e/s:t/l),r=i?t/i:t,r}getPixelPropValue(e,t){return parseFloat(getComputedStyle(e)[t].replace("px",""))}setImageVisible(e){e?this.image.classList.remove("d-none"):this.image.classList.add("d-none")}}}(Utils||(Utils={})),function(e){e.HtmlUtils=class{static getAriaLabeledBy(e){return e.getAttribute("aria-labelledby").split(" ")}static getIdSelector(e){return`#${e}`}static displayElement(e,t,i){const r="d-none";let n=document.querySelector(e);i?(t&&n.classList.add(t),n.classList.remove(r)):(n.classList.add(r),t&&n.classList.remove(t))}static displayElementDefault(t,i){e.HtmlUtils.displayElement(t,void 0,i)}static displayElementBlock(t,i){e.HtmlUtils.displayElement(t,"d-block",i)}static displayElementFlex(t,i){e.HtmlUtils.displayElement(t,"d-flex",i)}static isInputChecked(e){return e.checked}static closestWithClass(e,t,i){if(i&&e.classList.contains(t))return e;let r=e;for(;(r=r.parentNode)&&(!r.classList||!r.classList.contains(t)););return r}static each(e,t){let i=document.querySelectorAll(e);Array.prototype.forEach.call(i,(function(e){t(e)}))}static empty(e){e.textContent=""}}}(Utils||(Utils={})),function(e){e.StringUtils=class{static isNumber(e){return!isNaN(parseInt(e))}}}(Utils||(Utils={})),function(e){class t{static logEvent(e,i){t.logEventInternal(e,i)}static logError(e,i){t.logEventInternal("Error",e,i)}static logEventInternal(e,i,r){if(!("ga"in window))return;let n=ga.getAll()[0];n&&(r?n.send(t.gaEventParam,e,i,r):n.send(t.gaEventParam,e,i))}}t.gaEventParam="event",e.GAEventLogger=t}(Utils||(Utils={})),function(e){e.GAJsErrorLogger=class{constructor(t){this.logJsError=(t,i,r,n,s)=>{let o;return o=t.toLowerCase().indexOf("script error")>-1?"Script error":`Message: ${t}; URL: ${i}; Line: ${r}; Column: ${n}; Stack: ${s&&s.stack?s.stack:""};`,e.GAEventLogger.logError(`${this.page}JsError`,o),!1},this.page=t,window.onerror=this.logJsError}}}(Utils||(Utils={})),function(e){e.TranslateService=class{static translate(t,...i){if(languageTranslate&&languageTranslate.hasOwnProperty(t)){let e=languageTranslate[t];if(0===i.length)return e;let r=e;for(let e=0;e<i.length;e++)r=r.replace(`{${e}}`,i[e]);return r}return e.GAEventLogger.logError("Translate",`Untranslated string '${t}'`),t}}}(Utils||(Utils={})),function(Utils){class JSLoader{constructor(e,t){this.url=e,this.testObjectName=t}async loadScript(){let testObject=eval(this.testObjectName);if(testObject)return Promise.resolve();let useCdn=cdnConfig.useCdn,url=useCdn?cdnConfig.cdnPrefix+this.url:this.url,loadFailed=!1,loadScriptPromise=this.loadScriptInternal(url,useCdn);try{await loadScriptPromise}catch(e){loadFailed=!0}return loadFailed?this.loadScriptInternal(this.url,!1):Promise.resolve()}loadScriptInternal(e,t){return new Promise(((i,r)=>{let n=document.createElement("script");n.src=e,t&&(n.crossOrigin="anonymous"),n.onload=()=>i(),n.onerror=()=>r(new Error(`Script load error: '${e}'`)),document.body.appendChild(n)}))}}Utils.JSLoader=JSLoader}(Utils||(Utils={})),function(e){e.EditOperationRedirectResult=class{}}(EditOperations||(EditOperations={})),function(e){e.EditOperationErrorResult=class{}}(EditOperations||(EditOperations={})),function(e){e.EditOperationSuccessResult=class{}}(EditOperations||(EditOperations={})),function(e){class t{constructor(e,t,i,r,n){this.operationId=e,this.operationTriggerSelector=t,this.statusContainerSelector=i,this.apiEndpoint=r,this.imgResizer=n}setProgressMediator(e){this.progressMediator=e}init(){Utils.BrowserUtils.onDocumentReady((()=>{document.querySelector(this.operationTriggerSelector).addEventListener("click",(e=>{this.handleOperationTriggerClick(e.target)}));let e=document.querySelector(t.EditPanelSelector);e&&(e.addEventListener("imageOperationStartEvent",(e=>{let t=e.detail.operationId;this.handleImageOperationStartEvent(t)})),e.addEventListener("imageOperationCompleteEvent",(e=>{let t=e.detail.operationId,i=e.detail.successResult;this.handleImageOperationCompleteEvent(t,i)})))}))}handleOperationTriggerClick(e){if(!this.permitOperation())return;this.initOperation();let i=this.gatherOperationParams(),r=document.querySelector(t.CultureHdnSelector).value;i.culture=r;let n=this.validateData(i);if(n)return this.hideCurrentStatus(),void this.setError(n);Utils.Ajax.post(this.apiEndpoint,i,void 0,void 0,(e=>{this.handleOperationResult(e)}),(e=>{this.handleOperationFail(e)})),this.hideCurrentStatus(),this.triggerImageOperationStartEvent(),Utils.GAEventLogger.logEvent(t.EditOperationGACategory,this.operationId)}permitOperation(){return!0}initOperation(){}validateData(e){}getImage(){return document.querySelector(t.EditPanelSelector)}handleOperationResult(e){let i=e.redirectUrl;if(void 0!==i){let e=document.querySelector(t.UrlCultureHdnSelector);if(e){let t="/"+e.value;0!=i.indexOf(t)&&(i=t+i)}return void window.location.replace(i)}let r=e.errorMessage;if(null!=r)return this.triggerImageOperationCompleteEvent(void 0),void this.setError(r);let n=e;this.setCurrentImageInfo(n)}setCurrentImageInfo(e){let i=this.getImage(),r=new Image;r.addEventListener("load",(()=>{this.imgResizer.setNewImageToFitContainer(r.naturalWidth,r.naturalHeight,e.currentImagePreviewLink),this.triggerImageOperationCompleteEvent(e)})),r.addEventListener("error",(()=>{i.src=r.src,this.triggerImageOperationCompleteEvent(e)})),r.src=e.currentImagePreviewLink,r.complete&&Utils.EventUtils.triggerEvent(r,"load"),document.querySelector(t.CurrentImageDimensionSelector).textContent=e.currentImageSizeFormatted.toString(),document.querySelector(t.CurrentImageWeightSelector).textContent=e.currentImageLengthFormatted.toString(),document.querySelector(t.CurrentImageFormatSelector).textContent=e.currentImageFormat.toUpperCase(),document.querySelector(t.WidthToHeightHdnSelector).value=e.currentImageWidthToHeightRatio.toString(),document.querySelector(t.WidthHdnSelector).value=e.currentImageWidth.toString(),document.querySelector(t.HeightHdnSelector).value=e.currentImageHeight.toString()}handleOperationFail(e){this.triggerImageOperationCompleteEvent(void 0),this.setError(Utils.TranslateService.translate("Error_ServiceUnavailable")),Utils.GAEventLogger.logError("Edit",`Response status: ${e.status}`)}setError(e){let i=document.querySelector(t.ErrorMessageTemplateSelector).cloneNode(!0);i.id="operationError",i.textContent=e,i.classList.remove("d-none"),document.querySelector(this.statusContainerSelector).appendChild(i),Utils.HtmlUtils.displayElementFlex(this.statusContainerSelector,!0)}triggerImageOperationStartEvent(){Utils.EventUtils.triggerCustomEvent(document.querySelector(t.EditPanelSelector),"imageOperationStartEvent",{operationId:this.operationId})}triggerImageOperationCompleteEvent(e){Utils.EventUtils.triggerCustomEvent(document.querySelector(t.EditPanelSelector),"imageOperationCompleteEvent",{operationId:this.operationId,successResult:e})}handleImageOperationStartEvent(e){this.operationId===e&&(this.setControlsEnabled(!0),this.setOperationProgress(!0),this.progressMediator.signalOperationStart())}handleImageOperationCompleteEvent(e,t){this.operationId===e&&(this.setOperationProgress(!1),this.setControlsEnabled(!1),this.progressMediator.signalOperationComplete())}hideCurrentStatus(){Utils.HtmlUtils.displayElementFlex(this.statusContainerSelector,!1),Utils.HtmlUtils.empty(document.querySelector(this.statusContainerSelector))}setOperationProgress(e){Utils.HtmlUtils.displayElementDefault(`${this.operationTriggerSelector} > .operation-progress`,e)}setControlsEnabled(e){this.setOperationTriggerEnabled(!e),this.setControlButtonsEnabled(!e)}setOperationTriggerEnabled(e){this.setHtmlInputsEnabled(document.querySelector(this.operationTriggerSelector),e)}setHtmlInputsEnabled(e,t){const i="disabled";t?e.removeAttribute(i):e.setAttribute(i,"")}setControlButtonsEnabled(e){Utils.HtmlUtils.each(t.ControlButtonsSelector,(t=>{this.setHtmlDisabledClass(t,e),this.setAriaDisabledAttr(t,e)}))}setHtmlDisabledClass(e,t){const i="disabled";t?e.classList.remove(i):e.classList.add(i)}setAriaDisabledAttr(e,t){const i="aria-disabled";t?e.setAttribute(i,"false"):e.setAttribute(i,"true")}}t.EditOperationGACategory="Edit",t.MaxSizeHdnSelector="#maxSizeHdn",t.MaxResolutionHdnSelector="#maxResolutionHdn",t.WidthHdnSelector="#widthHdn",t.HeightHdnSelector="#heightHdn",t.WidthToHeightHdnSelector="#wToHRatioHdn",t.CultureHdnSelector="#cultureHdn",t.UrlCultureHdnSelector="#urlCultureHdn",t.EditToolboxSelector="#editToolbox",t.EditPanelSelector="#editPanel",t.OperationProgressSelector="#operationProgress",t.ErrorMessageTemplateSelector="#editErrorMessage",t.ControlButtonsSelector="#uploadNewBtn, #revertBtn, #downloadBtn",t.CurrentImageDimensionSelector="#currentImageDimension",t.CurrentImageWeightSelector="#currentImageWeight",t.CurrentImageFormatSelector="#currentImageFormat",e.BaseOperation=t}(EditOperations||(EditOperations={})),function(e){!function(t){class i extends e.BaseOperation{constructor(e,t,i,n,s,o,a,l){super(e,t,i,n,s),this.isOriginalOrientation=!0,this.handleImageChangingEvent=()=>{this.isActive&&this.destroyCropper()},this.handleImageChangedEvent=()=>{this.isActive&&this.checkCropBox(!1)},this.handleCropBoxOptionChangedEvent=e=>{let t=e.target.checked;t?this.createCropper():this.destroyCropper(),this.setOperationTriggerEnabled(t)},this.handleSelectedToolboxChangedEvent=e=>{"complete"===document.readyState?this.selectedToolboxChangedHanlder(e):Utils.BrowserUtils.onWindowLoad((()=>{this.selectedToolboxChangedHanlder(e)}))},this.selectedToolboxChangedHanlder=e=>{"crop"===e.toLowerCase()?(this.isActive=!0,this.cropBoxChecked()&&this.createCropper()):(this.isActive=!1,this.cropBoxChecked()&&this.destroyCropper())},this.handleAspectRatioChange=()=>{this.isOriginalOrientation=!0,this.cropBoxChecked()?this.recreateCropper():this.checkCropBox(!0);let e=document.querySelector(this.aspectRatioSelect).value!==r[r.Custom];Utils.HtmlUtils.displayElementDefault(this.btnCropOrientSelector,e)},this.handleCropOrientationChange=()=>{this.isOriginalOrientation=!this.isOriginalOrientation,this.cropBoxChecked()&&this.recreateCropper()},this.handleCropperAreaChanged=()=>{let e=this.getCropArea();this.progressMediator.signalCropperAreaChanged(e)},this.aspectRatioSelect=o,this.btnCropOrientSelector=a,this.cropBoxCheckbox=document.querySelector(l),this.isActive=!1}init(){super.init(),Utils.BrowserUtils.onDocumentReady((()=>{this.image=document.querySelector(e.BaseOperation.EditPanelSelector),this.image.addEventListener("imageChanging",this.handleImageChangingEvent),this.image.addEventListener("imageChanged",this.handleImageChangedEvent),this.cropBoxCheckbox.addEventListener("change",this.handleCropBoxOptionChangedEvent),document.querySelector(e.BaseOperation.EditToolboxSelector).addEventListener("selectedToolboxChanged",(e=>{let t=e.detail.toolboxId;this.handleSelectedToolboxChangedEvent(t)})),document.querySelector(this.aspectRatioSelect).addEventListener("change",this.handleAspectRatioChange),document.querySelector(this.btnCropOrientSelector).addEventListener("click",this.handleCropOrientationChange)}))}permitOperation(){return this.rcrop}setControlsEnabled(e){super.setControlsEnabled(e);let t=document.querySelector(this.aspectRatioSelect).value!==r[r.Custom],i=!e;this.setHtmlInputsEnabled(document.querySelector(this.aspectRatioSelect),i),this.setHtmlInputsEnabled(this.cropBoxCheckbox,i),t&&this.setHtmlInputsEnabled(document.querySelector(this.btnCropOrientSelector),i)}recreateCropper(){this.destroyCropper(),this.createCropper()}cropBoxChecked(){return Utils.HtmlUtils.isInputChecked(this.cropBoxCheckbox)}checkCropBox(e){this.cropBoxCheckbox.checked=e,Utils.EventUtils.triggerEvent(this.cropBoxCheckbox,"change")}async createCropper(){let e=new Utils.JSLoader("/js/pages/edit/crop.min.js?v=1","window.ResponsiveCrop");try{await e.loadScript()}catch(e){Utils.GAEventLogger.logError("LoadCropJs",e.message)}let t=this.collectCropperParams();this.rcrop=new ResponsiveCrop(this.image,t),this.image.addEventListener("rcrop-changed",this.handleCropperAreaChanged),this.image.addEventListener("rcrop-ready",this.handleCropperAreaChanged),this.progressMediator.signalCropperCreated()}collectCropperParams(){let e,t=document.querySelector(this.aspectRatioSelect).value,i=!1;if(t!==r[r.Custom]){if(t===r[r.Original]){let t=this.image.width,i=this.image.height,r=Math.min(t,i),n=t/r,s=i/r;e=this.createArray(n,s,this.isOriginalOrientation)}else{let i=t.split("x"),r=parseFloat(i[0]),n=parseFloat(i[1]);e=this.createArray(r,n,this.isOriginalOrientation)}i=!0}return e&&i?{grid:!0,minSize:e,preserveAspectRatio:i}:{grid:!0}}createArray(e,t,i){return i?[e,t]:[t,e]}destroyCropper(){this.rcrop&&this.rcrop.destroy(),this.progressMediator.signalCropperDestroyed()}gatherOperationParams(){let e=this.getCropArea(),i=document.querySelector(this.aspectRatioSelect).value;return new t.CropOperationParams(e.x,e.y,e.width,e.height,i)}getCropArea(){let t=this.rcrop.getValues(),i=this.image.naturalWidth,r=(parseInt(document.querySelector(e.BaseOperation.WidthHdnSelector).value)+0)/i;return{x:this.scaleSize(t.x,r),y:this.scaleSize(t.y,r),width:this.fixupSize(this.scaleSize(t.width,r)),height:this.fixupSize(this.scaleSize(t.height,r))}}scaleSize(e,t){return Math.round(e*t)}fixupSize(e){return 0===e?1:e}}let r;t.CropOperation=i,function(e){e[e.Original=0]="Original",e[e.Custom=1]="Custom"}(r||(r={}))}(e.Crop||(e.Crop={}))}(EditOperations||(EditOperations={})),function(e){(e.Crop||(e.Crop={})).CropOperationParams=class{constructor(e,t,i,r,n){this.x=e,this.y=t,this.width=i,this.height=r,this.aspectRatio=n}}}(EditOperations||(EditOperations={})),function(e){(e.Crop||(e.Crop={})).CropStatus=class{constructor(e){this.cropStatusSelector=e}display(e){Utils.HtmlUtils.displayElementFlex(this.cropStatusSelector,e)}setStatus(e){e?document.querySelector(this.cropStatusSelector).textContent=Utils.TranslateService.translate("Edit_CropAreaInfo",e.width,e.height):Utils.HtmlUtils.empty(document.querySelector(this.cropStatusSelector))}}}(EditOperations||(EditOperations={})),function(e){!function(t){class i extends e.BaseOperation{constructor(e,t,i,r,n,s,o,a,l,c,d,u){super(e,t,i,r,n),this.handlePercentageInputChange=e=>{let t=Utils.HtmlUtils.isInputChecked(e.target),i=t?this.percentageResizeDivSelector:this.pixelResizeDivSelector,r=i===this.percentageResizeDivSelector?this.pixelResizeDivSelector:this.percentageResizeDivSelector;Utils.HtmlUtils.displayElementDefault(r,!1),Utils.HtmlUtils.displayElementDefault(i,!0),this.validateInputs(t)},this.handleResizePercentageInputChange=()=>{let e=this.validatePercentageInput();super.setOperationTriggerEnabled(e)},this.percentageInput=document.querySelector(s),this.pixelResizeDivSelector=o,this.percentageResizeDivSelector=a,this.widthInput=document.querySelector(l),this.heightInput=document.querySelector(c),this.fixedRatioInput=document.querySelector(d),this.resizePercentageInput=document.querySelector(u)}init(){Utils.BrowserUtils.onDocumentReady((()=>{this.validateInputs(Utils.HtmlUtils.isInputChecked(this.percentageInput));let e=e=>{this.handleInputChange(e.target)};this.widthInput.addEventListener("input",e),this.heightInput.addEventListener("input",e),this.resizePercentageInput.addEventListener("input",this.handleResizePercentageInputChange),this.setHtmlInputsEnabled(this.percentageInput,!0),this.percentageInput.addEventListener("change",this.handlePercentageInputChange)})),super.init()}validateInputs(e){let t=e?this.validatePercentageInput():this.validatePixelInputs();super.setOperationTriggerEnabled(t)}validatePercentageInput(){let t=this.resizePercentageInput.value;if(!Utils.StringUtils.isNumber(t))return!1;let i=parseInt(t);if(i<1)this.resizePercentageInput.value="1";else{let t=(i+0)/100,r=this.getInputValue(document.querySelector(e.BaseOperation.MaxSizeHdnSelector)),n=(r+0)/this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)),s=(r+0)/this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector)),o=Math.min(n,s);if(t>o){let e=Math.floor(100*o);this.resizePercentageInput.value=e.toString()}}return!0}validatePixelInputs(){return!!this.validatePixelInput(this.widthInput)&&this.validatePixelInput(this.heightInput)}validatePixelInput(t){let i=t.value;if(!Utils.StringUtils.isNumber(i))return!1;let r=parseInt(i),n=parseInt(t.getAttribute("min")),s=this.getInputValue(document.querySelector(e.BaseOperation.MaxSizeHdnSelector));return this.valueInsideInterval(r,n,s)}setControlsEnabled(e){super.setControlsEnabled(e);let t=!e;this.setHtmlInputsEnabled(this.percentageInput,t),this.setHtmlInputsEnabled(this.widthInput,t),this.setHtmlInputsEnabled(this.heightInput,t),this.setHtmlInputsEnabled(this.resizePercentageInput,t)}handleInputChange(t){let i=t.value;if(!Utils.StringUtils.isNumber(i))return void super.setOperationTriggerEnabled(!1);let r=parseInt(i),n=parseInt(t.getAttribute("min")),s=this.getInputValue(document.querySelector(e.BaseOperation.MaxSizeHdnSelector)),o=t.id===this.widthInput.id,a=o?this.heightInput:this.widthInput;if(Utils.HtmlUtils.isInputChecked(this.fixedRatioInput)){let i,l,c=parseFloat(document.querySelector(e.BaseOperation.WidthToHeightHdnSelector).value),d=(e,t)=>this.calcWidth(e,t),u=(e,t)=>this.calcHeight(e,t);o?(i=d,l=u):(i=u,l=d),this.handleResizeWithRatio(t,r,a,n,s,c,i,l),super.setOperationTriggerEnabled(!0)}else{this.handleResizeWithoutRatio(t,r,n,s);let e=Utils.StringUtils.isNumber(a.value);super.setOperationTriggerEnabled(e)}}handleResizeWithoutRatio(e,t,i,r){if(!this.valueInsideInterval(t,i,r)){let n=this.getClosestValue(t,i,r);e.value=n.toString()}}handleResizeWithRatio(e,t,i,r,n,s,o,a){this.valueInsideInterval(t,r,n)||(t=this.getClosestValue(t,r,n));let l=a(t,s);this.valueInsideInterval(l,r,n,!1)||(l=this.getClosestValue(l,r,n),t=o(l,s)),e.value=t.toString(),i.value=l.toString()}valueInsideInterval(e,t,i,r=!0){return r?e>=t&&e<=i:e>t&&e<i}getClosestValue(e,t,i){return Math.abs(e-t)<Math.abs(e-i)?t:i}calcWidth(e,t){return Math.round(e*t)}calcHeight(e,t){return Math.round(e/t)}initOperation(){Utils.HtmlUtils.isInputChecked(this.percentageInput)&&this.validatePercentageInput()}validateData(t){let i,r=t.width,n=t.height;if(r&&n){let t=this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)),s=this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector));if(!(r<=t&&n<=s)){let t=this.getInputValue(document.querySelector(e.BaseOperation.MaxResolutionHdnSelector)),s=r*n;if(s>t){let e=Math.ceil(100*(1-(t+0)/s));i=Utils.TranslateService.translate("Edit_Error_ResizeSizeTooLarge",e)}}}return i}gatherOperationParams(){let i,r;if(Utils.HtmlUtils.isInputChecked(this.percentageInput)){let n=this.getInputValue(document.querySelector(e.BaseOperation.WidthHdnSelector)),s=this.getInputValue(document.querySelector(e.BaseOperation.HeightHdnSelector)),o=this.getInputValue(this.resizePercentageInput);return i=this.calcSizeByPercentage(n,o),r=this.calcSizeByPercentage(s,o),new t.ResizeOperationParams(i,r,o)}return i=this.getInputValue(this.widthInput),r=this.getInputValue(this.heightInput),new t.ResizeOperationParams(i,r,void 0)}calcSizeByPercentage(e,t){let i=Math.floor((e*t+0)/100);return Math.max(1,i)}getInputValue(e){return parseInt(e.value)}handleImageOperationCompleteEvent(e,t){super.handleImageOperationCompleteEvent(e,t),t&&(this.widthInput.value=t.currentImageWidth.toString(),this.heightInput.value=t.currentImageHeight.toString(),this.setOperationTriggerEnabled(!0))}}t.ResizeOperation=i}(e.Resize||(e.Resize={}))}(EditOperations||(EditOperations={})),function(e){(e.Resize||(e.Resize={})).ResizeOperationParams=class{constructor(e,t,i){this.width=e,this.height=t,this.percentage=i}}}(EditOperations||(EditOperations={})),function(e){!function(t){class i extends e.BaseOperation{constructor(e,t,i,r,n,s){super(e,t,i,r,n),this.mirrorInputName=s}gatherOperationParams(){let e=document.querySelector(`input[name='${this.mirrorInputName}']:checked`).value;if("horizontal"!=e&&"vertical"!=e)throw new Error("Mirror param");return new t.MirrorOperationParams(e)}}t.MirrorOperation=i}(e.Mirror||(e.Mirror={}))}(EditOperations||(EditOperations={})),function(e){(e.Mirror||(e.Mirror={})).MirrorOperationParams=class{constructor(e){this.mirrorDirection=e}}}(EditOperations||(EditOperations={})),function(e){!function(t){class i extends e.BaseOperation{constructor(t,i,n,s,o,a,l,c,d,u,h){super(t,i,n,s,o),this.handleRotateDirectionChange=()=>{this.resetAngleToDefault()},this.handleRotateAngleChange=()=>{let e,t=this.getSelectedAngle();this.applyRotateTransform(t),e=0===t?this.getSelectedDirection()===r.CCW?r.CW:r.CCW:t<0?r.CCW:r.CW;let i=e===r.CCW?this.rotateCCWInputSelector:this.rotateCWInputSelector;document.querySelector(i).checked=!0,this.updateAngleLabel(t)},this.resetAngleToDefault=()=>{this.applyRotateTransform(0),document.querySelector(this.rotateAngleInputSelector).value=(0).toString(),this.updateAngleLabel(0)},this.updateAngleLabel=e=>{let t=this.normalizeAngle(e);document.querySelector(this.rotateAngleLabelSelector).textContent=`${Math.abs(t)}°`},this.getSelectedDirection=()=>document.querySelector(`input[name='${this.rotateDirectionInputName}']:checked`).value===r[r.CCW]?r.CCW:r.CW,this.getSelectedAngle=()=>{let e=document.querySelector(this.rotateAngleInputSelector).value;return parseInt(e)},this.rotateDirectionInputName=a,this.rotateCCWInputSelector=l,this.rotateCWInputSelector=c,this.rotateAngleInputSelector=u,this.rotateAngleLabelSelector=d,this.enlargeBackgroundCheckboxSelector=h,Utils.BrowserUtils.onDocumentReady((()=>{document.querySelector(e.BaseOperation.EditToolboxSelector).addEventListener("selectedToolboxChanged",(e=>{let t=e.detail.toolboxId;this.handleSelectedToolboxChangedEvent(t)})),document.querySelector(this.rotateCCWInputSelector).addEventListener("change",this.handleRotateDirectionChange),document.querySelector(this.rotateCWInputSelector).addEventListener("change",this.handleRotateDirectionChange),document.querySelector(this.rotateAngleInputSelector).addEventListener("input",this.handleRotateAngleChange),document.querySelector(this.rotateAngleInputSelector).addEventListener("change",this.handleRotateAngleChange)}))}handleSelectedToolboxChangedEvent(e){this.resetAngleToDefault()}applyRotateTransform(t){let i=0===t?"":`rotate(${t}deg)`;document.querySelector(e.BaseOperation.EditPanelSelector).style.transform=i}gatherOperationParams(){let e=this.getSelectedAngle(),i=this.getSelectedDirection()===r.CCW;0===e&&(e=90*(i?-1:1));let n=Utils.HtmlUtils.isInputChecked(document.querySelector(this.enlargeBackgroundCheckboxSelector));return new t.RotateOperationParams(e,n,i)}normalizeAngle(e){return 0===e?90:e}handleImageOperationCompleteEvent(e,t){super.handleImageOperationCompleteEvent(e,t),t&&this.resetAngleToDefault()}}let r;t.RotateOperation=i,function(e){e[e.CCW=0]="CCW",e[e.CW=1]="CW"}(r||(r={}))}(e.Rotate||(e.Rotate={}))}(EditOperations||(EditOperations={})),function(e){(e.Rotate||(e.Rotate={})).RotateOperationParams=class{constructor(e,t,i){this.rotateAngle=e,this.enlargeBackground=t,this.rotateCcw=i}}}(EditOperations||(EditOperations={})),function(e){!function(t){class i extends e.BaseOperation{constructor(e,t,i,r,n,s){super(e,t,i,r,n),this.convertImageOptionsSelector=s}gatherOperationParams(){return new t.ConvertOperationParams(document.querySelector(this.convertImageOptionsSelector).value)}}t.ConvertOperation=i}(e.Convert||(e.Convert={}))}(EditOperations||(EditOperations={})),function(e){(e.Convert||(e.Convert={})).ConvertOperationParams=class{constructor(e){this.formatExtension=e}}}(EditOperations||(EditOperations={})),function(e){!function(t){class i extends e.BaseOperation{constructor(e,t,i,r,n,s,o,a,l,c,d,u,h,p){super(e,t,i,r,n),this.handleSizeInputFocus=()=>{document.querySelector(this.compressToSizeInputSelector).checked=!0},this.compressResultTemplateSelector=s,this.compressToSizeInputSelector=o,this.compressionTypeInputName=a,this.compressSizeInputSelector=l,this.compressUnitSelectSelector=c,this.compressUnavailableMsgSelector=d,this.compressResultMsgSelector=u,this.sizeBeforeLabelSelector=h,this.sizeAfterLabelSelector=p}init(){super.init(),Utils.BrowserUtils.onDocumentReady((()=>{document.querySelector(this.compressSizeInputSelector).addEventListener("focus",this.handleSizeInputFocus)}))}isCompressionTypeAuto(){return"auto"===document.querySelector(`input[name='${this.compressionTypeInputName}']:checked`).value}gatherOperationParams(){let e;if(this.isCompressionTypeAuto())e=new t.CompressOperationParams(!0);else{let i="KB"===document.querySelector(this.compressUnitSelectSelector).value?1:1024,r=document.querySelector(this.compressSizeInputSelector).value,n=parseInt(r);e=isNaN(n)?new t.CompressOperationParams(!1):new t.CompressOperationParams(!1,n*i)}return e}handleImageOperationCompleteEvent(e,t){super.handleImageOperationCompleteEvent(e,t),t&&("Compress"===e?this.setResultMessage(t):"Convert"===e&&this.handleImageFormatChanged(t))}handleImageFormatChanged(e){let t,i=e.currentImageFormat.toUpperCase();t="JPG"===i||"PNG"===i||"GIF"===i,this.setOperationTriggerEnabled(t),Utils.HtmlUtils.displayElementBlock(this.compressUnavailableMsgSelector,!t)}setResultMessage(e){let t=document.querySelector(this.compressResultTemplateSelector).cloneNode(!0);t.id="compressResult",t.classList.add("d-flex"),t.classList.remove("d-none"),document.querySelector(this.statusContainerSelector).appendChild(t),Utils.HtmlUtils.displayElementFlex(this.statusContainerSelector,!0),document.querySelector(`#compressResult ${this.compressResultMsgSelector}`).innerHTML=Utils.TranslateService.translate("Edit_CompressToolbox_CompressResultInPercents",`<strong>${e.compressionRatio}</strong>`),document.querySelector(`#compressResult ${this.sizeBeforeLabelSelector}`).textContent=e.previousImageLengthFormatted.toString(),document.querySelector(`#compressResult ${this.sizeAfterLabelSelector}`).textContent=e.currentImageLengthFormatted.toString()}}t.CompressOperation=i}(e.Compress||(e.Compress={}))}(EditOperations||(EditOperations={})),function(e){(e.Compress||(e.Compress={})).CompressOperationParams=class{constructor(e,t){this.auto=e,this.size=t}}}(EditOperations||(EditOperations={})),function(e){e.OperationProgress=class{constructor(e){this.progressIndicatorSelector=e}display(e){Utils.HtmlUtils.displayElementFlex(this.progressIndicatorSelector,e)}}}(Edit||(Edit={})),function(e){e.ProgressMediator=class{constructor(e,t,i,r){this.operationProgress=i,this.cropStatus=r,this.editOperations=t,t.forEach((e=>{e.setProgressMediator(this)})),this.initialLoaderActive=!0,Utils.BrowserUtils.onDocumentReady((()=>{Utils.BrowserUtils.onWindowLoad((()=>{this.operationProgress.display(!1),this.initialLoaderActive=!1}))}))}signalOperationStart(){this.cropperActive&&this.cropStatus.display(!1),this.operationProgress.display(!0)}signalOperationComplete(){this.operationProgress.display(!1),this.cropperActive&&this.cropStatus.display(!0)}signalCropperCreated(){this.initialLoaderActive&&this.operationProgress.display(!1),this.cropStatus.setStatus(void 0),this.cropStatus.display(!0),this.cropperActive=!0}signalCropperAreaChanged(e){this.cropStatus.setStatus(e)}signalCropperDestroyed(){this.cropStatus.display(!1),this.cropperActive=!1}}}(Edit||(Edit={})),function(e){class t{static post(e,i,r,n,s,o,a=!1){let l=i instanceof FormData,c=l?i:t.encodeObject(i);t.postWithRetry(e,c,l,r,n,s,o,a,!0)}static postWithRetry(i,r,n,s,o,a,l,c,d){let u=new XMLHttpRequest;u.onreadystatechange=function(){u.readyState===XMLHttpRequest.DONE&&(200===u.status?(o&&o(),a(JSON.parse(u.responseText))):c&&d?t.postWithRetry(i,r,n,s,o,a,l,c,!1):(o&&o(),l(u)))},u.open("POST",i,!0),s&&u.setRequestHeader(s.name,s.value),n||u.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");try{u.send(r)}catch(t){e.GAEventLogger.logError("Ajax",`Url:${i}, Error:${t.message}`)}}static encodeObject(e){let t=[],i=/%20/g;for(let r in e){let n=e[r],s=void 0===n?"":n,o=`${encodeURIComponent(r).replace(i,"+")}=${encodeURIComponent(s).replace(i,"+")}`;t.push(o)}return t.join("&")}}e.Ajax=t}(Utils||(Utils={})),Shared||(Shared={}),new class{constructor(){Utils.BrowserUtils.onDocumentReady((function(){let e=document.querySelector("#cookieConsentAccept");e&&e.addEventListener("click",(function(e){document.cookie=e.target.getAttribute("data-cookie-string");let t=document.querySelector("#cookieConsent");t.classList.add("d-none"),t.classList.remove("d-flex")}))}))}},function(e){class t{constructor(){Utils.BrowserUtils.onDocumentReady((function(){t.Menus.forEach((function(e){new i(e)})),i.initHideOnClick(t.Menus)}))}}t.Menus=["#lang","#menu"],e.DropdownMenus=t;class i{constructor(e){document.querySelector(`${e} > .${i.DropdownToggleClass}`).addEventListener("click",(function(r){t.Menus.filter((t=>t!==e)).forEach(i.hideMenu),document.querySelector(`${e} > .${i.DropdownMenuClass}`).classList.toggle(i.ShowDropdownClass),r.preventDefault(),r.stopPropagation()}))}static initHideOnClick(e){window.addEventListener("click",(function(){e.forEach(i.hideMenu)}))}static hideMenu(e){let t=document.querySelector(`${e} > .${i.DropdownMenuClass}`);t.classList.contains(i.ShowDropdownClass)&&t.classList.remove(i.ShowDropdownClass)}}i.DropdownToggleClass="dropdown-toggle",i.DropdownMenuClass="dropdown-menu",i.ShowDropdownClass="show-dropdown"}(Shared||(Shared={}));class EditPage{constructor(){if(this.imgSelector="#editPanel",new Utils.GAJsErrorLogger("Edit"),this.isImageExists()){this.imgResizer=new Utils.ImageResize(this.imgSelector);let e=(new EditOperationControls).init(this.imgResizer);(new EditPanel).init(this.imgResizer),new EditToolbox(this.imgSelector).init();let t=new Edit.OperationProgress("#operationProgress"),i=new EditOperations.Crop.CropStatus("#cropAreaInfo");new Edit.ProgressMediator(window,e,t,i)}else new EditToolbox(this.imgSelector).init();new Shared.DropdownMenus}isImageExists(){return"true"===document.querySelector("#hasImageHdn").value}}class EditToolbox{constructor(e){this.editToolboxSelector="#editToolbox",this.toolboxChangedTriggered=!1,this.triggerSelectedToolboxChangedEventOnLoad=e=>{let t=document.querySelector("#editToolbox .toolbox-panel.collapse.show"),i=t?t.getAttribute("data-toolboxid"):void 0;if(i||!e)this.triggerSelectedToolboxChangedEvent(i);else{let e=this;setTimeout((function(){e.triggerSelectedToolboxChangedEventOnLoad(!1)}),500)}},this.editPanelSelector=e}init(){Utils.BrowserUtils.onDocumentReady((()=>{document.querySelector("#editMenu").addEventListener("click",(e=>{this.imageEditingActive||this.handleEditMenuClick(e.target)}));let e=function(e){e.preventDefault()};Utils.HtmlUtils.each("#editMenu a.toolbox-nav-link",(function(t){t.addEventListener("click",e)}));let t=e=>{this.imageEditingActive||this.expandCollapsed(e.currentTarget)};Utils.HtmlUtils.each("#editToolbox div.card-item-header",(function(e){e.addEventListener("click",t)}));let i=e=>{let t=e.currentTarget;this.setParentToolboxVisible(t,"toolbox",!0),this.setExpanderAriaExpandedAttr(t,!1)},r=e=>{let t=e.currentTarget;this.setParentToolboxVisible(t,"toolbox",!1),this.setActiveEditMenuItem(t),this.setExpanderAriaExpandedAttr(t,!0)};Utils.HtmlUtils.each("#editToolbox .toolbox-panel",(function(e){e.addEventListener("hide.bs.collapse",i),e.addEventListener("show.bs.collapse",r)}));let n=()=>{this.toolboxChangedTriggered||(this.triggerSelectedToolboxChangedEventOnLoad(!0),this.toolboxChangedTriggered=!0)},s=document.querySelector(this.editPanelSelector);s&&(s.addEventListener("imageOperationStartEvent",(()=>{this.imageEditingActive=!0})),s.addEventListener("imageOperationCompleteEvent",(()=>{this.imageEditingActive=!1})),s.complete?n():Utils.EventUtils.oneTimeEvent(s,"load",n)),Utils.BrowserUtils.onWindowLoad(n)}))}handleEditMenuClick(e){let t=Utils.HtmlUtils.closestWithClass(e,"edit-menu-nav",!0);t&&this.expandCollapsed(t)}expandCollapsed(e){let t=document.querySelector(Utils.HtmlUtils.getIdSelector(e.getAttribute("aria-controls")));t.classList.contains("collapse")&&t.classList.contains("show")||(new bootstrap.Collapse(t,{toggle:!1,parent:"#editToolbox"}).show(),this.triggerSelectedToolboxChangedEvent(t.getAttribute("data-toolboxid")))}triggerSelectedToolboxChangedEvent(e){Utils.EventUtils.triggerCustomEvent(document.querySelector(this.editToolboxSelector),"selectedToolboxChanged",{toolboxId:e})}setActiveEditMenuItem(e){let t=Utils.HtmlUtils.getAriaLabeledBy(e).filter((function(e){return!!document.querySelector(Utils.HtmlUtils.getIdSelector(e)).classList.contains("edit-menu-nav")})).shift();document.querySelector("#editMenu a.toolbox-nav-link.active").classList.remove("active"),document.querySelector(Utils.HtmlUtils.getIdSelector(t)).classList.add("active")}setExpanderAriaExpandedAttr(e,t){Utils.HtmlUtils.getAriaLabeledBy(e).forEach((function(e){document.querySelector(Utils.HtmlUtils.getIdSelector(e)).setAttribute("aria-expanded",t.toString())}))}setParentToolboxVisible(e,t,i){let r="d-block",n="d-sm-none",s=Utils.HtmlUtils.closestWithClass(e,t,!1).classList;i?(s.add(r,n),s.contains(n)||s.add(n)):(s.remove(r,n),s.contains(n)&&s.remove(n))}}class EditPanel{constructor(){this.resizeHanlderRegistered=!1}init(e){let t=()=>{this.resizeHanlderRegistered||(window.addEventListener("resize",(function(){e.resizeImageToFitContainer()})),this.resizeHanlderRegistered=!0,e.resizeImageToFitContainer())};Utils.BrowserUtils.onDocumentReady((function(){let i=e.image;i.complete?t():(Utils.EventUtils.oneTimeEvent(i,"load",t),Utils.EventUtils.oneTimeEvent(i,"error",t))}))}}class EditOperationControls{init(e){let t=new Array;return t.push(new EditOperations.Resize.ResizeOperation("Resize","#resizeImageBtn","#resizeStatus","/api/ResizeImage",e,"#percentageCheckbox","#pixelResizeDiv","#percentageResizeDiv","#resizeWidthInput","#resizeHeightInput","#resizeAspectRatioCheckbox","#resizePercentageInput")),t.push(new EditOperations.Rotate.RotateOperation("Rotate","#rotateImageBtn","#rotateStatus","/api/RotateImage",e,"rotateDirection","#rotateCCWInput","#rotateCWInput","#rotateAngleLabel","#rotateAngleInput","#enlargeBackgroundCheckbox")),t.push(new EditOperations.Crop.CropOperation("Crop","#cropImageBtn","#cropStatus","/api/CropImage",e,"#aspectRatioSelect","#btnCropOrient","#cropBoxCheckbox")),t.push(new EditOperations.Mirror.MirrorOperation("Mirror","#mirrorImageBtn","#mirrorStatus","/api/MirrorImage",e,"mirrorDirection")),t.push(new EditOperations.Convert.ConvertOperation("Convert","#convertImageBtn","#convertStatus","/api/ConvertImage",e,"#convertImageSelect")),t.push(new EditOperations.Compress.CompressOperation("Compress","#compressImageBtn","#compressStatus","/api/CompressImage",e,"#compressResultTemplate","#compressToSizeInput","compressionType","#compressSizeInput","#compressUnitSelect","#compressUnavailableMsg",".compress-result-msg",".size-before-label",".size-after-label")),t.forEach((e=>e.init())),t}}new EditPage;